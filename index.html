<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PasteBin Clone</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0C0C0C;
            color: #fff;
        }
        
        .navbar {
            background: #181818;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            font-weight: 600;
            font-size: 20px;
            color: #fff;
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .nav-links a {
            color: #888;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
        }
        
        .nav-links a:hover {
            color: #fff;
        }
        
        .search-box {
            background: #282828;
            border: 1px solid #333;
            padding: 8px 12px;
            color: #fff;
            width: 300px;
            border-radius: 4px;
        }
        
        .container {
            display: flex;
            max-width: 1400px;
            margin: 20px auto;
            gap: 20px;
            padding: 0 20px;
        }
        
        .main-content {
            flex: 2;
        }
        
        .paste-list {
            background: #181818;
            padding: 20px;
            border-radius: 4px;
        }
        
        .paste-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            color: #888;
            font-size: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid #282828;
        }
        
        .paste-item {
            padding: 15px;
            border-bottom: 1px solid #282828;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .paste-item:hover {
            background: #222;
        }
        
        .paste-item:last-child {
            border-bottom: none;
        }
        
        .paste-title {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
        }
        
        .paste-title:hover {
            text-decoration: underline;
        }
        
        .paste-meta {
            color: #888;
            font-size: 12px;
            display: flex;
            gap: 15px;
        }
        
        .user-sidebar {
            flex: 1;
            background: #181818;
            padding: 20px;
            border-radius: 4px;
            text-align: center;
            height: fit-content;
            position: sticky;
            top: 80px;
        }
        
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #333;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #666;
            border: 3px solid #444;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .avatar:hover::after {
            content: 'Change';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: #fff;
            font-size: 12px;
            padding: 5px;
        }
        
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .username {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .user-bio {
            color: #888;
            font-size: 13px;
            margin: 10px 0;
            padding: 0 10px;
        }
        
        .user-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            font-size: 14px;
            color: #888;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            color: #fff;
            font-weight: 600;
            font-size: 18px;
        }
        
        .button {
            background: #333;
            color: #fff;
            border: none;
            padding: 10px 20px;
            width: 100%;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .button:hover {
            background: #444;
        }
        
        .button-danger {
            background: #753B3B;
        }
        
        .button-danger:hover {
            background: #4D2727;
        }
        
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #888;
            font-size: 13px;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            background: #282828;
            border: 1px solid #333;
            padding: 10px;
            color: #fff;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #666;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #1a1a1a;
            padding: 30px;
            width: 500px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 8px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close {
            color: #888;
            font-size: 24px;
            cursor: pointer;
        }
        
        .close:hover {
            color: #fff;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 8px 16px;
            background: #282828;
            color: #888;
            cursor: pointer;
            border: none;
            font-size: 14px;
            border-radius: 4px;
        }
        
        .tab.active {
            background: #444;
            color: #fff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .upload-area {
            border: 2px dashed #444;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            border-radius: 8px;
        }
        
        .upload-area:hover {
            border-color: #666;
            background: #222;
        }
        
        .upload-area i {
            font-size: 40px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .error {
            color: #ff4444;
            font-size: 13px;
            margin-top: 5px;
        }
        
        .success {
            color: #44ff44;
            font-size: 13px;
            margin-top: 5px;
        }
        
        .pinned-badge {
            background: #ffd700;
            color: #000;
            padding: 2px 6px;
            font-size: 11px;
            border-radius: 3px;
            margin-left: 8px;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: #fff;
            padding: 12px 24px;
            border-radius: 4px;
            display: none;
            z-index: 2000;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .comment-section {
            margin-top: 20px;
            padding: 20px;
            background: #181818;
            border-radius: 4px;
        }
        
        .comment {
            padding: 15px;
            border-bottom: 1px solid #282828;
        }
        
        .comment:last-child {
            border-bottom: none;
        }
        
        .comment-meta {
            color: #888;
            font-size: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .comment-content {
            color: #fff;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .reaction-buttons {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .reaction-button {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .reaction-button:hover {
            color: #fff;
        }
        
        .reaction-button.active {
            color: #ff4444;
        }
        
        .separator {
            height: 1px;
            background: #282828;
            margin: 15px 0;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .info-label {
            color: #888;
        }
        
        .info-value {
            color: #fff;
        }
        
        .info-value a {
            color: #2A9FD6;
            text-decoration: none;
        }
        
        .info-value a:hover {
            text-decoration: underline;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .page-button {
            background: #282828;
            border: none;
            color: #888;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .page-button.active {
            background: #444;
            color: #fff;
        }
        
        .page-button:hover {
            background: #333;
        }
        
        .profile-link {
            color: #2A9FD6;
            text-decoration: none;
            cursor: pointer;
        }
        
        .profile-link:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .navbar {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-box {
                width: 100%;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="navbar">
        <a href="#" onclick="showHome()" class="logo">PASTEBIN</a>
        <div class="nav-links" id="navLinks">
            <a href="#" onclick="showHome()">Home</a>
            <a href="#" onclick="showModal('upload')">Add Paste</a>
            <a href="#" onclick="showUsers()">Users</a>
            <a href="#" id="authLink" onclick="showModal('login')">Login</a>
        </div>
        <input type="text" class="search-box" id="searchInput" placeholder="Search pastes..." onkeyup="searchPastes()">
    </div>

    <!-- Main container -->
    <div class="container">
        <!-- Main content area (changes based on view) -->
        <div class="main-content" id="mainContent"></div>

        <!-- User sidebar (always visible) -->
        <div class="user-sidebar" id="userSidebar"></div>
    </div>

    <!-- Modals -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Login</h3>
                <span class="close" onclick="hideModal('login')">&times;</span>
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="loginUsername" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" placeholder="Enter password">
            </div>
            <div id="loginError" class="error"></div>
            <button class="button" onclick="handleLogin()">Login</button>
            <p style="text-align: center; margin-top: 15px; font-size: 13px; color: #888;">
                Don't have an account? <a href="#" onclick="switchModal('login', 'register')">Register</a>
            </p>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Register</h3>
                <span class="close" onclick="hideModal('register')">&times;</span>
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="regUsername" placeholder="Choose username">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="regEmail" placeholder="Enter email">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="regPassword" placeholder="Choose password">
            </div>
            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" id="regConfirm" placeholder="Confirm password">
            </div>
            <div id="registerError" class="error"></div>
            <button class="button" onclick="handleRegister()">Register</button>
            <p style="text-align: center; margin-top: 15px; font-size: 13px; color: #888;">
                Already have an account? <a href="#" onclick="switchModal('register', 'login')">Login</a>
            </p>
        </div>
    </div>

    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Paste</h3>
                <span class="close" onclick="hideModal('upload')">&times;</span>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('upload', 'text')">Text</button>
                <button class="tab" onclick="switchTab('upload', 'file')">File</button>
            </div>
            <div id="textTab" class="tab-content active">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="pasteTitle" placeholder="Enter paste title">
                </div>
                <div class="form-group">
                    <label>Content</label>
                    <textarea id="pasteContent" rows="10" placeholder="Enter paste content..."></textarea>
                </div>
                <div class="form-group">
                    <label>Syntax Highlighting</label>
                    <select id="pasteSyntax">
                        <option value="text">Plain Text</option>
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                        <option value="json">JSON</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Visibility</label>
                    <select id="pasteVisibility">
                        <option value="public">Public</option>
                        <option value="unlisted">Unlisted</option>
                        <option value="private">Private</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Expiration</label>
                    <select id="pasteExpiration">
                        <option value="never">Never</option>
                        <option value="1hour">1 Hour</option>
                        <option value="1day">1 Day</option>
                        <option value="1week">1 Week</option>
                        <option value="1month">1 Month</option>
                    </select>
                </div>
                <div id="uploadError" class="error"></div>
                <button class="button" onclick="handleUpload()">Create Paste</button>
            </div>
            <div id="fileTab" class="tab-content">
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Click to upload or drag and drop</p>
                    <p style="font-size: 12px; color: #666;">Any file up to 10MB</p>
                    <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect()">
                </div>
                <div id="fileName" style="color: #888; margin-top: 10px;"></div>
            </div>
        </div>
    </div>

    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile</h3>
                <span class="close" onclick="hideModal('edit-profile')">&times;</span>
            </div>
            <div class="form-group">
                <label>Display Name</label>
                <input type="text" id="displayName">
            </div>
            <div class="form-group">
                <label>Bio</label>
                <textarea id="bio" rows="4" placeholder="Tell us about yourself..."></textarea>
            </div>
            <div class="form-group">
                <label>Website</label>
                <input type="url" id="website" placeholder="https://...">
            </div>
            <div class="form-group">
                <label>Location</label>
                <input type="text" id="location" placeholder="City, Country">
            </div>
            <div id="profileError" class="error"></div>
            <button class="button" onclick="saveProfile()">Save Changes</button>
        </div>
    </div>

    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Avatar</h3>
                <span class="close" onclick="hideModal('avatar')">&times;</span>
            </div>
            <div class="upload-area" onclick="document.getElementById('avatarInput').click()">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to upload avatar</p>
                <p style="font-size: 12px; color: #666;">PNG, JPG up to 2MB</p>
                <input type="file" id="avatarInput" style="display: none;" accept="image/*" onchange="handleAvatarSelect()">
            </div>
        </div>
    </div>

    <div id="viewPasteModal" class="modal">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <h3 id="viewPasteTitle"></h3>
                <span class="close" onclick="hideModal('view-paste')">&times;</span>
            </div>
            <div id="pasteInfo" style="margin-bottom: 20px;"></div>
            <pre id="pasteContent" style="background: #282828; padding: 15px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap;"></pre>
            <div id="pasteReactions" class="reaction-buttons"></div>
            <div class="separator"></div>
            <div id="pasteComments"></div>
            <div class="form-group" id="commentForm" style="display: none;">
                <textarea id="commentInput" placeholder="Add a comment..." rows="3"></textarea>
                <button class="button" onclick="addComment()">Post Comment</button>
            </div>
        </div>
    </div>

    <div id="userProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="profileUsername"></h3>
                <span class="close" onclick="hideModal('user-profile')">&times;</span>
            </div>
            <div id="userProfileContent"></div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Initialize data
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let pastes = JSON.parse(localStorage.getItem('pastes')) || [];
        let comments = JSON.parse(localStorage.getItem('comments')) || [];
        let reactions = JSON.parse(localStorage.getItem('reactions')) || {};

        // Initialize with demo data if empty
        if (users.length === 0) {
            users.push({
                id: 1,
                username: 'wspp',
                password: 'password123',
                email: 'wspp@example.com',
                displayName: 'wspp',
                bio: 'Just a regular user',
                website: '',
                location: 'Unknown',
                avatar: null,
                created: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                followers: [],
                following: []
            });
            localStorage.setItem('users', JSON.stringify(users));
        }

        if (pastes.length === 0) {
            pastes.push({
                id: 1,
                title: 'hipposniffer XD',
                content: 'This is a sample paste content...',
                author: 'wspp',
                authorId: 1,
                views: 4,
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                pinned: true,
                syntax: 'text',
                visibility: 'public',
                expiration: 'never',
                createdAt: Date.now()
            });
            localStorage.setItem('pastes', JSON.stringify(pastes));
        }

        // Navigation functions
        function showHome() {
            document.getElementById('mainContent').innerHTML = renderPasteList();
            updateURL('/');
        }

        function showUsers() {
            document.getElementById('mainContent').innerHTML = renderUserList();
            updateURL('/users');
        }

        function showUserProfile(username) {
            const user = users.find(u => u.username === username);
            if (user) {
                document.getElementById('profileUsername').textContent = user.displayName || user.username;
                document.getElementById('userProfileContent').innerHTML = renderUserProfile(user);
                showModal('user-profile');
            }
        }

        // Render functions
        function renderPasteList(filteredPastes = null) {
            const pastesToShow = filteredPastes || pastes.filter(p => p.visibility === 'public').sort((a, b) => b.createdAt - a.createdAt);
            const pinnedPastes = pastesToShow.filter(p => p.pinned);
            const regularPastes = pastesToShow.filter(p => !p.pinned);

            let html = `
                <div class="paste-list">
                    <div class="paste-header">
                        <span>Showing ${pastesToShow.length} of ${pastes.length} total pastes</span>
                        <span>Pinned Pastes • Latest</span>
                    </div>
            `;

            // Show pinned pastes first
            pinnedPastes.forEach(paste => {
                html += renderPasteItem(paste, true);
            });

            // Show regular pastes
            regularPastes.forEach(paste => {
                html += renderPasteItem(paste);
            });

            html += '</div>';
            return html;
        }

        function renderPasteItem(paste, pinned = false) {
            return `
                <div class="paste-item">
                    <div>
                        <a href="#" class="paste-title" onclick="viewPaste(${paste.id})">
                            ${paste.title}
                            ${pinned ? '<span class="pinned-badge">PINNED</span>' : ''}
                        </a>
                    </div>
                    <div class="paste-meta">
                        <span><i class="fas fa-eye"></i> ${paste.views}</span>
                        <span>${paste.date}</span>
                        <span><a href="#" class="profile-link" onclick="showUserProfile('${paste.author}')">${paste.author}</a></span>
                    </div>
                </div>
            `;
        }

        function renderUserList() {
            let html = `
                <div class="paste-list">
                    <div class="paste-header">
                        <span>Users (${users.length})</span>
                    </div>
            `;

            users.forEach(user => {
                const userPastes = pastes.filter(p => p.authorId === user.id).length;
                html += `
                    <div class="paste-item">
                        <div>
                            <a href="#" class="paste-title" onclick="showUserProfile('${user.username}')">
                                ${user.displayName || user.username}
                            </a>
                        </div>
                        <div class="paste-meta">
                            <span><i class="fas fa-paste"></i> ${userPastes} pastes</span>
                            <span>Joined ${user.created}</span>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            return html;
        }

        function renderUserProfile(user) {
            const userPastes = pastes.filter(p => p.authorId === user.id);
            const isCurrentUser = currentUser && currentUser.id === user.id;
            
            return `
                <div style="text-align: center;">
                    <div class="avatar" style="margin-bottom: 15px;">
                        ${user.avatar ? `<img src="${user.avatar}">` : '<i class="fas fa-user"></i>'}
                    </div>
                    <div class="username">${user.displayName || user.username}</div>
                    <div class="user-bio">${user.bio || 'No bio yet'}</div>
                    <div class="user-stats">
                        <div class="stat">
                            <div class="stat-value">${userPastes.length}</div>
                            <div>Pastes</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${user.followers?.length || 0}</div>
                            <div>Followers</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${user.following?.length || 0}</div>
                            <div>Following</div>
                        </div>
                    </div>
                    ${!isCurrentUser && currentUser ? `
                        <button class="button" onclick="toggleFollow(${user.id})">
                            ${currentUser.following?.includes(user.id) ? 'Unfollow' : 'Follow'}
                        </button>
                    ` : ''}
                    <div class="separator"></div>
                    <h4>Recent Pastes</h4>
                    ${userPastes.slice(0, 5).map(paste => `
                        <div class="paste-item">
                            <div>
                                <a href="#" class="paste-title" onclick="viewPaste(${paste.id})">${paste.title}</a>
                            </div>
                            <div class="paste-meta">${paste.date}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderSidebar() {
            let html = '';
            
            if (currentUser) {
                const userPastes = pastes.filter(p => p.authorId === currentUser.id).length;
                html = `
                    <div class="avatar" onclick="showModal('avatar')">
                        ${currentUser.avatar ? `<img src="${currentUser.avatar}">` : '<i class="fas fa-user"></i>'}
                    </div>
                    <div class="username">${currentUser.displayName || currentUser.username}</div>
                    <div class="user-bio">${currentUser.bio || 'No bio yet'}</div>
                    <div class="user-stats">
                        <div class="stat">
                            <div class="stat-value">${userPastes}</div>
                            <div>Pastes</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${currentUser.followers?.length || 0}</div>
                            <div>Followers</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${currentUser.following?.length || 0}</div>
                            <div>Following</div>
                        </div>
                    </div>
                    <button class="button" onclick="showModal('edit-profile')">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                    <button class="button" onclick="showModal('upload')">
                        <i class="fas fa-plus"></i> New Paste
                    </button>
                    <button class="button button-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    <div class="separator"></div>
                    <div style="text-align: left;">
                        <div class="info-row">
                            <span class="info-label">UID:</span>
                            <span class="info-value">${currentUser.id}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Created:</span>
                            <span class="info-value">${currentUser.created}</span>
                        </div>
                    </div>
                `;
            } else {
                html = `
                    <div class="avatar"><i class="fas fa-user"></i></div>
                    <div class="username">Guest</div>
                    <button class="button" onclick="showModal('login')">Login</button>
                    <button class="button" onclick="showModal('register')">Register</button>
                    <div class="separator"></div>
                    <div style="font-size: 13px; color: #888;">
                        Login to create pastes and comment
                    </div>
                `;
            }
            
            document.getElementById('userSidebar').innerHTML = html;
        }

        // Modal functions
        function showModal(modalName) {
            if (modalName === 'upload' && !currentUser) {
                showToast('Please login to create pastes');
                showModal('login');
                return;
            }
            
            if (modalName === 'edit-profile' && currentUser) {
                document.getElementById('displayName').value = currentUser.displayName || '';
                document.getElementById('bio').value = currentUser.bio || '';
                document.getElementById('website').value = currentUser.website || '';
                document.getElementById('location').value = currentUser.location || '';
            }
            
            document.getElementById(modalName + 'Modal').classList.add('active');
        }
        
        function hideModal(modalName) {
            document.getElementById(modalName + 'Modal').classList.remove('active');
        }
        
        function switchModal(hide, show) {
            hideModal(hide);
            showModal(show);
        }
        
        function switchTab(modal, tab) {
            document.querySelectorAll(`#${modal}Modal .tab`).forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll(`#${modal}Modal .tab-content`).forEach(c => c.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        // Auth functions
        function handleLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (!username || !password) {
                errorDiv.textContent = 'Please fill in all fields';
                return;
            }
            
            const user = users.find(u => (u.username === username || u.email === username) && u.password === password);
            
            if (user) {
                currentUser = JSON.parse(JSON.stringify(user));
                delete currentUser.password;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showToast('Logged in successfully!');
                hideModal('login');
                updateUI();
            } else {
                errorDiv.textContent = 'Invalid username or password';
            }
        }
        
        function handleRegister() {
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirm = document.getElementById('regConfirm').value;
            const errorDiv = document.getElementById('registerError');
            
            if (!username || !email || !password || !confirm) {
                errorDiv.textContent = 'Please fill in all fields';
                return;
            }
            
            if (password !== confirm) {
                errorDiv.textContent = 'Passwords do not match';
                return;
            }
            
            if (users.find(u => u.username === username)) {
                errorDiv.textContent = 'Username already exists';
                return;
            }
            
            if (users.find(u => u.email === email)) {
                errorDiv.textContent = 'Email already registered';
                return;
            }
            
            const newUser = {
                id: users.length + 1,
                username: username,
                password: password,
                email: email,
                displayName: username,
                bio: '',
                website: '',
                location: '',
                avatar: null,
                created: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                followers: [],
                following: []
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            showToast('Registered successfully! Please login.');
            switchModal('register', 'login');
        }
        
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showToast('Logged out');
            updateUI();
            showHome();
        }

        // Paste functions
        function handleUpload() {
            if (!currentUser) return;
            
            const title = document.getElementById('pasteTitle').value;
            const content = document.getElementById('pasteContent').value;
            const syntax = document.getElementById('pasteSyntax').value;
            const visibility = document.getElementById('pasteVisibility').value;
            const expiration = document.getElementById('pasteExpiration').value;
            const errorDiv = document.getElementById('uploadError');
            
            if (!title || !content) {
                errorDiv.textContent = 'Please fill in all fields';
                return;
            }
            
            const newPaste = {
                id: pastes.length + 1,
                title: title,
                content: content,
                author: currentUser.username,
                authorId: currentUser.id,
                views: 0,
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                syntax: syntax,
                visibility: visibility,
                expiration: expiration,
                pinned: false,
                createdAt: Date.now()
            };
            
            pastes.unshift(newPaste);
            localStorage.setItem('pastes', JSON.stringify(pastes));
            
            showToast('Paste created successfully!');
            hideModal('upload');
            document.getElementById('pasteTitle').value = '';
            document.getElementById('pasteContent').value = '';
            showHome();
        }
        
        function handleFileSelect() {
            const file = document.getElementById('fileInput').files[0];
            if (file) {
                document.getElementById('fileName').innerHTML = `Selected: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('pasteContent').value = e.target.result;
                    document.getElementById('pasteTitle').value = file.name.replace(/\.[^/.]+$/, '');
                    switchTab('upload', 'text');
                };
                reader.readAsText(file);
            }
        }

        function viewPaste(id) {
            const paste = pastes.find(p => p.id === id);
            if (paste) {
                paste.views++;
                localStorage.setItem('pastes', JSON.stringify(pastes));
                
                document.getElementById('viewPasteTitle').textContent = paste.title;
                document.getElementById('pasteContent').textContent = paste.content;
                
                // Syntax highlighting class
                if (paste.syntax !== 'text') {
                    document.getElementById('pasteContent').className = `language-${paste.syntax}`;
                }
                
                // Paste info
                const pasteComments = comments.filter(c => c.pasteId === id);
                document.getElementById('pasteInfo').innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Author:</span>
                        <span class="info-value"><a href="#" class="profile-link" onclick="showUserProfile('${paste.author}')">${paste.author}</a></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Created:</span>
                        <span class="info-value">${paste.date}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Views:</span>
                        <span class="info-value">${paste.views}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Comments:</span>
                        <span class="info-value">${pasteComments.length}</span>
                    </div>
                `;
                
                // Reactions
                const pasteReactions = reactions[id] || { likes: 0, dislikes: 0, userReaction: null };
                document.getElementById('pasteReactions').innerHTML = `
                    <button class="reaction-button ${pasteReactions.userReaction === 'like' ? 'active' : ''}" onclick="addReaction(${id}, 'like')">
                        <i class="fas fa-thumbs-up"></i> ${pasteReactions.likes}
                    </button>
                    <button class="reaction-button ${pasteReactions.userReaction === 'dislike' ? 'active' : ''}" onclick="addReaction(${id}, 'dislike')">
                        <i class="fas fa-thumbs-down"></i> ${pasteReactions.dislikes}
                    </button>
                `;
                
                // Comments
                document.getElementById('pasteComments').innerHTML = pasteComments.map(comment => `
                    <div class="comment">
                        <div class="comment-meta">
                            <span><a href="#" class="profile-link" onclick="showUserProfile('${comment.author}')">${comment.author}</a> • ${comment.date}</span>
                        </div>
                        <div class="comment-content">${comment.content}</div>
                    </div>
                `).join('');
                
                document.getElementById('commentForm').style.display = currentUser ? 'block' : 'none';
                document.getElementById('commentInput').value = '';
                
                showModal('view-paste');
            }
        }

        function addComment() {
            if (!currentUser) {
                showToast('Please login to comment');
                hideModal('view-paste');
                showModal('login');
                return;
            }
            
            const pasteId = parseInt(document.getElementById('viewPasteTitle').textContent.split(' ')[0]) || 1;
            const content = document.getElementById('commentInput').value;
            
            if (!content) return;
            
            const newComment = {
                id: comments.length + 1,
                pasteId: pasteId,
                author: currentUser.username,
                authorId: currentUser.id,
                content: content,
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
            };
            
            comments.push(newComment);
            localStorage.setItem('comments', JSON.stringify(comments));
            
            showToast('Comment added!');
            viewPaste(pasteId);
        }

        function addReaction(pasteId, type) {
            if (!currentUser) {
                showToast('Please login to react');
                hideModal('view-paste');
                showModal('login');
                return;
            }
            
            if (!reactions[pasteId]) {
                reactions[pasteId] = { likes: 0, dislikes: 0, userReaction: null };
            }
            
            const pasteReaction = reactions[pasteId];
            
            if (pasteReaction.userReaction === type) {
                // Remove reaction
                pasteReaction[type + 's']--;
                pasteReaction.userReaction = null;
            } else {
                // Remove previous reaction if exists
                if (pasteReaction.userReaction) {
                    pasteReaction[pasteReaction.userReaction + 's']--;
                }
                // Add new reaction
                pasteReaction[type + 's']++;
                pasteReaction.userReaction = type;
            }
            
            localStorage.setItem('reactions', JSON.stringify(reactions));
            viewPaste(pasteId);
        }

        // Profile functions
        function saveProfile() {
            if (!currentUser) return;
            
            currentUser.displayName = document.getElementById('displayName').value || currentUser.username;
            currentUser.bio = document.getElementById('bio').value;
            currentUser.website = document.getElementById('website').value;
            currentUser.location = document.getElementById('location').value;
            
            const index = users.findIndex(u => u.id === currentUser.id);
            users[index] = { ...users[index], ...currentUser };
            
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            showToast('Profile updated!');
            hideModal('edit-profile');
            updateUI();
        }
        
        function handleAvatarSelect() {
            const file = document.getElementById('avatarInput').files[0];
            if (file && currentUser) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentUser.avatar = e.target.result;
                    
                    const index = users.findIndex(u => u.id === currentUser.id);
                    users[index].avatar = e.target.result;
                    
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    showToast('Avatar updated!');
                    hideModal('avatar');
                    updateUI();
                };
                reader.readAsDataURL(file);
            }
        }

        function toggleFollow(userId) {
            if (!currentUser) {
                showToast('Please login to follow users');
                showModal('login');
                return;
            }
            
            const userIndex = users.findIndex(u => u.id === userId);
            const currentUserIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (!users[currentUserIndex].following) {
                users[currentUserIndex].following = [];
            }
            
            if (!users[userIndex].followers) {
                users[userIndex].followers = [];
            }
            
            const isFollowing = users[currentUserIndex].following.includes(userId);
            
            if (isFollowing) {
                users[currentUserIndex].following = users[currentUserIndex].following.filter(id => id !== userId);
                users[userIndex].followers = users[userIndex].followers.filter(id => id !== currentUser.id);
            } else {
                users[currentUserIndex].following.push(userId);
                users[userIndex].followers.push(currentUser.id);
            }
            
            currentUser.following = users[currentUserIndex].following;
            
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            showToast(isFollowing ? 'Unfollowed' : 'Following');
            updateUI();
            showUserProfile(users[userIndex].username);
        }

        // Search function
        function searchPastes() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query) {
                showHome();
                return;
            }
            
            const filtered = pastes.filter(p => 
                p.visibility === 'public' && 
                (p.title.toLowerCase().includes(query) || 
                 p.content.toLowerCase().includes(query) ||
                 p.author.toLowerCase().includes(query))
            );
            
            document.getElementById('mainContent').innerHTML = renderPasteList(filtered);
        }

        // URL handling
        function updateURL(path) {
            history.pushState({}, '', path);
        }

        // Toast function
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Update UI function
        function updateUI() {
            renderSidebar();
            
            // Update navigation
            const navLinks = document.getElementById('navLinks');
            if (currentUser) {
                navLinks.innerHTML = `
                    <a href="#" onclick="showHome()">Home</a>
                    <a href="#" onclick="showModal('upload')">Add Paste</a>
                    <a href="#" onclick="showUsers()">Users</a>
                    <a href="#" onclick="showUserProfile('${currentUser.username}')">Profile</a>
                    <a href="#" onclick="logout()">Logout</a>
                `;
            } else {
                navLinks.innerHTML = `
                    <a href="#" onclick="showHome()">Home</a>
                    <a href="#" onclick="showModal('upload')">Add Paste</a>
                    <a href="#" onclick="showUsers()">Users</a>
                    <a href="#" onclick="showModal('login')">Login</a>
                `;
            }
        }

        // Initialize
        updateUI();
        showHome();

        // Handle browser back/forward
        window.onpopstate = function() {
            if (location.pathname === '/users') {
                showUsers();
            } else {
                showHome();
            }
        };

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
